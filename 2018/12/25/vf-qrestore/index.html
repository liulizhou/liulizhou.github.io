<!DOCTYPE html>
<html lang="zh-CN" >
<head><meta name="generator" content="Hexo 3.8.0">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="身后有尾巴!!!">
	<meta name="keywords" content="Blog">
	<title>vf_qrestore - Liu Lizhou</title>
    <link rel="alternate" href type="application/atom+xml">
	<link rel="shortcut icon" href>
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" href="/css/style.css">
</head>

<body>
	<div class="body-box">
		<!-- 内容 -->
		<div class="content-box">
			<div class="sidebar">
	<div class="widget-me">
			<h2 class="me-name">
					<a href="/">站点</a>
					<small>站点描述</small>
			</h2>
			<div class="me-avatar">
					<a href="/"><img src="/imgs/avatar.jpeg"></a>
			</div>
	</div>
	<div class="sidebar-wrap">
		<div class="widget-account">
				<ul>
					
						<li>
								<a href="/">
										<i class="fa fa-github"></i>
								</a>
						</li>
					
						<li>
								<a href="/">
										<i class="fa fa-facebook"></i>
								</a>
						</li>
					
						<li>
								<a href="/">
										<i class="fa fa-google"></i>
								</a>
						</li>
					
						<li>
								<a href="/">
										<i class="fa fa-instagram"></i>
								</a>
						</li>
					
				</ul>
		</div>
		<div class="widget-nav">
				<nav class="nav-list">
						<ul>
								
										<li>
												<a href="/" class>
														<span>主页</span>
												</a>
										</li>
								
										<li>
												<a href="/archives/" class>
														<span>归档</span>
												</a>
										</li>
								
										<li>
												<a href="/about/" class>
														<span>关于</span>
												</a>
										</li>
								
						</ul>
				</nav>
		</div>
		<div class="widget-search">
			<h2 class="widget-title">搜索</h2>
			<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search"><input type="search" name="q" class="search-input" placeholder="搜索"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
		</div>
		
			<div class="widget-late">
			<h2 class="widget-title">近期</h2>
			<ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/01/21/deep-learning-report/">deep-learning-report</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/07/deep-learning-architecture/">deep-learning-architecture</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/28/HDR-Project/">HDR-Project</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/25/vf-qrestore/">vf_qrestore</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/19/vim-using-skill/">vim-using-skill</a></li></ul>
		</div>
		
		<div class="widget-tags">
			<h2 class="widget-title">标签</h2>
			<a href="/tags/AR/" style="font-size: 17.5px;">AR</a> <a href="/tags/CNN/" style="font-size: 10px;">CNN</a> <a href="/tags/GAN/" style="font-size: 10px;">GAN</a> <a href="/tags/ICCV/" style="font-size: 12.5px;">ICCV</a> <a href="/tags/IQ/" style="font-size: 10px;">IQ</a> <a href="/tags/Paper/" style="font-size: 12.5px;">Paper</a> <a href="/tags/VQ/" style="font-size: 10px;">VQ</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/command/" style="font-size: 12.5px;">command</a> <a href="/tags/conda/" style="font-size: 10px;">conda</a> <a href="/tags/cute/" style="font-size: 10px;">cute</a> <a href="/tags/filter/" style="font-size: 10px;">filter</a> <a href="/tags/gflags/" style="font-size: 10px;">gflags</a> <a href="/tags/hansome/" style="font-size: 10px;">hansome</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/i3/" style="font-size: 10px;">i3</a> <a href="/tags/index/" style="font-size: 15px;">index</a> <a href="/tags/install/" style="font-size: 15px;">install</a> <a href="/tags/libtorch/" style="font-size: 10px;">libtorch</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/mount/" style="font-size: 10px;">mount</a> <a href="/tags/pytorch/" style="font-size: 12.5px;">pytorch</a> <a href="/tags/qrestore/" style="font-size: 10px;">qrestore</a> <a href="/tags/skill/" style="font-size: 10px;">skill</a> <a href="/tags/卷积，反卷积/" style="font-size: 10px;">卷积，反卷积</a>
		</div>
		<div class="widget-categories">
			<h2 class="widget-title">分类</h2>
			<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AR/">AR</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Deep-Learning/">Deep Learning</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Image-Process/">Image Process</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/conda/">conda</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gflags/">gflags</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/gflags/libtorch/">libtorch</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/i3/">i3</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/install/">install</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/install/bug/">bug</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/index/">index</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/pytorch/">pytorch</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/pytorch/index/">index</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/qiyi-ffmpeg-filter/">qiyi-ffmpeg-filter</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/report/">report</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/人物/">人物</a><span class="category-list-count">1</span></li></ul>
		</div>
	</div>
</div>

			<div class="content-article">
				<div class="banner" style="background-image: url(/imgs/header.jpg)">
					<i class="fa fa-reorder mobile-toggle" style="display:none;"></i>
				</div>
				<div class="content-article-box">
					<article class="article  article-post">
    <h2 class="article-title cl">
        <a href="/2018/12/25/vf-qrestore/" title="vf_qrestore">vf_qrestore</a>
        <small class="article-time">2018-12-25</small>
    </h2>
    <div class="article-con">
        
        <p>本文档记录qiyi-filter的生成和使用方法</p>
<a id="more"></a>
<h1 id="文件说明"><a href="#文件说明" class="headerlink" title="文件说明"></a>文件说明</h1><ol>
<li><p>涉及到四个文件<code>vf_qrestore.c</code> <code>qrestore.h</code> <code>qrestore.cpp</code></p>
</li>
<li><p><code>vf_qrestore</code> 提供的是<code>qiyi-ffmpeg</code>数据到libtorch数据转换和接口调用</p>
</li>
<li><code>qrestore</code> 实现了质量恢复方法，提供<code>c wrapper</code>调用 c++接口函数和<code>libtorch</code>库文件</li>
</ol>
<h1 id="集成步骤"><a href="#集成步骤" class="headerlink" title="集成步骤"></a>集成步骤</h1><p>集成步骤主要分四部：</p>
<ol>
<li><p>所有文件放到<code>libavfilter</code>目录下。</p>
</li>
<li><p>在<code>libavfilter/allfilters.c</code>文件中新增 <code>REGISTER_FILTER(QRESTORE,       qrestore,       vf);</code></p>
</li>
<li><p>修改<code>libavfilter/Makefile</code>文件，将需要编译的c文件引用进来<code>OBJS-$(CONFIG_QRESTORE_FILTER)               += vf_qrestore.o</code></p>
</li>
<li><p>修改<code>libavfilter/Makefile</code>文件，将需要编译的cpp和h文件引用进来，在 <code>HEADERS</code>处添加</p>
<p><code>qrestore.h</code>，在<code>OBJS</code>处添加<code>qrestore.h</code></p>
</li>
<li><p>配置<code>config-qiyi-simple</code>,链接<code>libtorch</code>库，这里给出<code>config-qiyi-simple</code>配置：</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure --<span class="built_in">enable</span>-yasm  --<span class="built_in">enable</span>-static   --<span class="built_in">enable</span>-nonfree --<span class="built_in">enable</span>-gpl   --<span class="built_in">disable</span>-filter=intertrustwm --<span class="built_in">disable</span>-filter=iqiyiwm --<span class="built_in">disable</span>-filter=css   --<span class="built_in">disable</span>-optimizations --extra-cflags=<span class="string">"-I/data/source/wrappertest/src -I/data/source/Qrestore/src -I/data/source/pytorch/torch/lib/tmp_install/include"</span> --extra-cxxflags=<span class="string">"-std=c++11"</span> --extra-ldflags=<span class="string">"-L/data/source/pytorch/torch/lib/tmp_install/lib -L/usr/local/cuda/lib64 -L/usr/local/lib -L/data/source/wrappertest/src -L/data/source/Qrestore/src/build"</span> --extra-libs=<span class="string">"-lCppAddWrapper -lCppAdd -ltorch -lcuda -lnvrtc -lnvToolsExt -lcudart_static -lpthread -ldl -lrt -lcaffe2 -lcaffe2_gpu -lc10 -lc10_cuda -lcufft -lcurand -lcudnn -lculibos -lcublas -lcublas_device -lstdc++"</span> --prefix=/usr/<span class="built_in">local</span>/ffmpeg_new_master</span><br></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="filter使用"><a href="#filter使用" class="headerlink" title="filter使用"></a><code>filter</code>使用</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./ffmpeg -i input -vf qrestore output</span><br></pre></td></tr></table></figure>
<h2 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">: <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"qrestore.h"</span></span></span><br><span class="line">: <span class="keyword">void</span> *qRestoreObj = getQRestoreObj(); <span class="comment">// get class QRestore object</span></span><br><span class="line">: getQFixedFrame(...); <span class="comment">// fix frame</span></span><br><span class="line">: rgb24_to_yuv420(...); <span class="comment">// result rgb convert to yuv</span></span><br><span class="line">@param: qRestoreObj</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getQFixedFrame</span><span class="params">(<span class="keyword">void</span> *qRestoreObj, <span class="keyword">uint8_t</span> *src, <span class="keyword">uint8_t</span> *dst, <span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">char</span> *modelPath)</span></span></span><br></pre></td></tr></table></figure>
    </div>
    
    <div class="article-navgition">
        <div class="navgition-wrap">
            
                <div class="navgition-prev">
                    <h2 class="navgition-title">上一篇: <a href="/2018/12/28/HDR-Project/"> HDR-Project </a></h2>
                </div>
            

            
                <div class="navgition-next">
                    <h2 class="navgition-title">下一篇: <a href="/2018/12/19/vim-using-skill/">vim-using-skill </a></h2>
                </div>
            
        </div>
    </div>
    
    
</article>

				</div>
				
				<footer class="footer">
	<p class="footer-intro">
		
		@2019 Liu Lizhou.
	</p>
	<p class="footer-intro">
			Powered By <a href="https://hexo.io/zh-cn/" target="_blank">hexo</a>
			theme <a href="https://github.com/shijuuu/hexo-theme-mokusei" target="_blank">Mokusei</a> by <a href="https://blog.shijukun.com" target="blank">Shiju</a>
	</p>
</footer>

<script src="/js/org/jquery.min.js"></script>

<script>
	(function(){
		var mobile_menu = $(".mobile-toggle");
		var con_box= $(".content-article");
		var ifs = 1;
		mobile_menu.on("touchstart", function(){
			if(ifs){
				con_box.css('overflow','hidden');
				con_box.animate({
					left: '250px'
				});
				ifs = 0;
			}else{
				con_box.css('overflow','visible');
				con_box.animate({
					left: '0px'
				});
				ifs = 1;
			}
		})
	})();
</script>




				
			</div>
		</div>
		
	</div>
</body>
</html>